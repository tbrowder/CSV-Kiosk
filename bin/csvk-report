#!/usr/bin/env raku
use v6.d;
use CSV::Kiosk::Report :sort-csv, :generate-pdf;

sub USAGE() {
    say q:to/END/;
Usage:
  bin/csvk-report sort --csv=<file> [--by=<hdr>] [--sep=<c>] [--out=<file>] [--numeric] [--reverse]
  bin/csvk-report --csv=<file> sort [--by=<hdr>] [--sep=<c>] [--out=<file>] [--numeric] [--reverse]
  bin/csvk-report pdf  --csv=<file> --out=<pdf> [--title=<s>] [--sep=<c>]
  bin/csvk-report --csv=<file> --out=<pdf> [--title=<s>] [--sep=<c>] pdf
END
}

sub MAIN(
    Str :$csv,
    Str :$out,
    Str :$by,
    Str :$sep = ',',
    Str :$title,
    Bool :$numeric = False,
    Bool :$reverse = False,
    *@cmd,
) {
    if @cmd.elems == 0 {
        USAGE();
        exit 2;
    }
    my $subcmd = @cmd[0];
    given $subcmd {
        when 'sort' {
            my $code = sort-csv(:$csv, :$by, :$sep, :$out, :$numeric, :$reverse);
            exit $code;
        }
        when 'pdf' {
            my $code = generate-pdf(:$csv, :$out, :$title);
            exit $code;
        }
        default {
            USAGE();
            exit 2;
        }
    }
}
